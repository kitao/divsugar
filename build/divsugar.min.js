(function(){var a,b=[].indexOf||function(e){for(var d=0,c=this.length;d<c;d++){if(d in this&&this[d]===e){return d}}return -1};a={_initialize:function(){var c,d=this;this.VERSION="0.8.0";this.EPSILON=0.0001;this.NUM_OF_DIGITS=4;this.DEG_TO_RAD=Math.PI/180;this.RAD_TO_DEG=180/Math.PI;console.log("DivSugar: version "+this.VERSION);this._curId=0;this.rootTask=null;(function(){var g,f,e;e=navigator.userAgent.toLowerCase();if(e.indexOf("safari")>-1||e.indexOf("chrome")>-1){d._prefix="webkit"}else{if(e.indexOf("firefox")>-1){d._prefix="moz"}else{if(e.indexOf("opera")>-1){d._prefix="o"}else{if(e.indexOf("msie")>-1){d._prefix="ms"}else{d._prefix=null}}}}console.log("DivSugar: use '"+d._prefix+"' as prefix");g=document.createElement("div");d.cssTransform="-"+d._prefix+"-transform";if(!(d.cssTransform in g.style)){d.cssTransform="transform"}console.log("DivSugar: use '"+d.cssTransform+"'");d.cssTransformStyle="-"+d._prefix+"-transform-style";if(!(d.cssTransformStyle in g.style)){d.cssTransformStyle="transform-style"}console.log("DivSugar: use '"+d.cssTransformStyle+"'");d.cssTransformOrigin="-"+d._prefix+"-transform-origin";if(!(d.cssTransformOrigin in g.style)){d.cssTransformOrigin="transform-origin"}console.log("DivSugar: use '"+d.cssTransformOrigin+"'");d.cssPerspective="-"+d._prefix+"-perspective";if(!(d.cssPerspective in g.style)){d.cssPerspective="perspective"}console.log("DivSugar: use '"+d.cssPerspective+"'");d.cssPerspectiveOrigin="-"+d._prefix+"-perspective-origin";if(!(d.cssPerspectiveOrigin in g.style)){d.cssPerspectiveOrigin="perspective-origin"}console.log("DivSugar: use '"+d.cssPerspectiveOrigin+"'");d.cssBackfaceVisibility="-"+d._prefix+"-backface-visibility";if(!(d.cssBackfaceVisibility in g.style)){d.cssBackfaceVisibility="backface-visibility"}console.log("DivSugar: use '"+d.cssBackfaceVisibility+"'");f=d._prefix+"RequestAnimationFrame";if(!(f in window)){f="requestAnimationFrame"}if(window[f]!=null){d.requestAnimationFrame=function(h){return window[f](h)};return console.log("DivSugar: use '"+f+"'")}else{d.requestAnimationFrame=function(h){return window.setTimeout(h,1000/60)};return console.log("DivSugar: use 'setTimeout' instead of 'requestAnimationFrame'")}})();c=function(){var f,e;f=new Date().getTime();e=f-d._lastUpdatedTime;d._lastUpdatedTime=f;d.rootTask.update(e);return d.requestAnimationFrame(c)};this._lastUpdatedTime=new Date().getTime();return this.requestAnimationFrame(c)},inherit:function(e,d){var c;c=function(){};c.prototype=d.prototype;e.prototype=new c();e.uber=d.prototype;e.prototype.constructor=e;return this},generateId:function(){return"_divsugar_id_"+(++this._curId)},getImageSize:function(d,e){var c;c=new Image();c.src=d;c.onload=function(){return e(c.width,c.height)};return this}};(window.DivSugar=a)._initialize();a.Vector=(function(){function c(d,g,f){var e;switch(arguments.length){case 0:this.x=this.y=this.z=0;break;case 1:e=d;this.x=e.x;this.y=e.y;this.z=e.z;break;case 3:this.x=d;this.y=g;this.z=f;break;default:throw"DivSugar: invalid number of arguments"}}c.prototype.set=function(d,g,f){var e;switch(arguments.length){case 1:e=d;this.x=e.x;this.y=e.y;this.z=e.z;break;case 3:this.x=d;this.y=g;this.z=f;break;default:throw"DivSugar: invalid number of arguments"}return this};c.prototype.neg=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};c.prototype.add=function(d){this.x+=d.x;this.y+=d.y;this.z+=d.z;return this};c.prototype.sub=function(d){this.x-=d.x;this.y-=d.y;this.z-=d.z;return this};c.prototype.mul=function(d){this.x*=d;this.y*=d;this.z*=d;return this};c.prototype.div=function(e){var d;d=1/e;this.x*=d;this.y*=d;this.z*=d;return this};c.prototype.norm=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};c.prototype.sqNorm=function(){return this.x*this.x+this.y*this.y+this.z*this.z};c.prototype.dist=function(d){return a.Vector._tmpVec1.set(this).sub(d).norm()};c.prototype.sqDist=function(d){return a.Vector._tmpVec1.set(this).sub(d).sqNorm()};c.prototype.dot=function(d){return this.x*d.x+this.y*d.y+this.z*d.z};c.prototype.cross=function(d){return this.set(this.y*d.z-this.z*d.y,this.z*d.x-this.x*d.z,this.x*d.y-this.y*d.x)};c.prototype.normalize=function(){var d;d=this.norm();if(d<a.EPSILON){return this.set(a.Vector.X_UNIT)}else{return this.div(d)}};c.prototype.rotate=function(g,f,d){var h,e;if(arguments.length!==3){throw"DivSugar: invalid number of arguments"}if(g!==0){e=Math.sin(g*a.DEG_TO_RAD);h=Math.cos(g*a.DEG_TO_RAD);this.set(this.x,this.y*h-this.z*e,this.z*h+this.y*e)}if(f!==0){e=Math.sin(f*a.DEG_TO_RAD);h=Math.cos(f*a.DEG_TO_RAD);this.set(this.x*h+this.z*e,this.y,this.z*h-this.x*e)}if(d!==0){e=Math.sin(d*a.DEG_TO_RAD);h=Math.cos(d*a.DEG_TO_RAD);this.set(this.x*h-this.y*e,this.y*h+this.x*e,this.z)}return this};c.prototype.lerp=function(f,e){var d;if(e>1-a.EPSILON){this.set(f)}else{if(e>=a.EPSILON){d=a.Vector._tmpVec1;d.set(f).mul(e);this.mul(1-e).add(d)}}return this};c.prototype.toLocal=function(e){var d;d=a.Vector._tmpVec1;d.set(this.sub(e.trans));return this.set(d.dot(e.xAxis)/e.xAxis.sqNorm(),d.dot(e.yAxis)/e.yAxis.sqNorm(),d.dot(e.zAxis)/e.zAxis.sqNorm())};c.prototype.toGlobal=function(e){var g,f,d;g=a.Vector._tmpVec1;f=a.Vector._tmpVec2;d=a.Vector._tmpVec3;g.set(e.xAxis).mul(this.x);f.set(e.yAxis).mul(this.y);d.set(e.zAxis).mul(this.z);return this.set(g).add(f).add(d).add(e.trans)};c.prototype.toLocal_noTrans=function(d){return this.set(this.dot(d.xAxis)/d.xAxis.sqNorm(),this.dot(d.yAxis)/d.yAxis.sqNorm(),this.dot(d.zAxis)/d.zAxis.sqNorm())};c.prototype.toGlobal_noTrans=function(e){var g,f,d;g=a.Vector._tmpVec1;f=a.Vector._tmpVec2;d=a.Vector._tmpVec3;g.set(e.xAxis).mul(this.x);f.set(e.yAxis).mul(this.y);d.set(e.zAxis).mul(this.z);return this.set(g).add(f).add(d)};c.prototype.equal=function(d){return this.x===d.x&&this.y===d.y&&this.z===d.z};c.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};return c})();a.Vector.ZERO=new a.Vector(0,0,0);a.Vector.X_UNIT=new a.Vector(1,0,0);a.Vector.Y_UNIT=new a.Vector(0,1,0);a.Vector.Z_UNIT=new a.Vector(0,0,1);a.Vector._tmpVec1=new a.Vector();a.Vector._tmpVec2=new a.Vector();a.Vector._tmpVec3=new a.Vector();a.Matrix=(function(){function c(d){switch(arguments.length){case 0:this.xAxis=new a.Vector(a.Vector.X_UNIT);this.yAxis=new a.Vector(a.Vector.Y_UNIT);this.zAxis=new a.Vector(a.Vector.Z_UNIT);this.trans=new a.Vector(a.Vector.ZERO);break;case 1:this.xAxis=new a.Vector(d.xAxis);this.yAxis=new a.Vector(d.yAxis);this.zAxis=new a.Vector(d.zAxis);this.trans=new a.Vector(d.trans);break;case 12:this.xAxis=new a.Vector(arguments[0],arguments[1],arguments[2]);this.yAxis=new a.Vector(arguments[3],arguments[4],arguments[5]);this.zAxis=new a.Vector(arguments[6],arguments[7],arguments[8]);this.trans=new a.Vector(arguments[9],arguments[10],arguments[11]);break;default:throw"DivSugar: invalid number of arguments"}}c.prototype.set=function(d){switch(arguments.length){case 1:this.xAxis.set(d.xAxis);this.yAxis.set(d.yAxis);this.zAxis.set(d.zAxis);this.trans.set(d.trans);break;case 12:this.xAxis.set(arguments[0],arguments[1],arguments[2]);this.yAxis.set(arguments[3],arguments[4],arguments[5]);this.zAxis.set(arguments[6],arguments[7],arguments[8]);this.trans.set(arguments[9],arguments[10],arguments[11]);break;default:throw"DivSugar: invalid number of arguments"}return this};c.prototype.fromQuaternion=function(g){var n,m,l,k,t,o,h,e,f,r,j,q,d,p,i,s;m=g.x;l=g.y;k=g.z;n=g.w;e=m+m;q=l+l;i=k+k;t=n*e;o=n*q;h=n*i;f=m*e;r=m*q;j=m*i;d=l*q;p=l*i;s=k*i;this.set(1-(d+s),r+h,j-o,r-h,1-(f+s),p+t,j+o,p-t,1-(f+d),0,0,0);return this};c.prototype.orthonormalize=function(){var f,e,d;f=a.Matrix._tmpVec1;e=a.Matrix._tmpVec2;d=a.Matrix._tmpVec3;d.set(this.zAxis).normalize();f.set(this.yAxis).cross(this.zAxis).normalize();e.set(d).cross(f);this.xAxis.set(f);this.yAxis.set(e);this.zAxis.set(d);return this};c.prototype.translate=function(d,i,h){var g,f,e;if(arguments.length!==3){throw"DivSugar: invalid number of arguments"}g=a.Matrix._tmpVec1;f=a.Matrix._tmpVec2;e=a.Matrix._tmpVec3;g.set(this.xAxis).mul(d);f.set(this.yAxis).mul(i);e.set(this.zAxis).mul(h);this.trans.add(g).add(f).add(e);return this};c.prototype.rotate=function(g,f,d){var i,h,e;if(arguments.length!==3){throw"DivSugar: invalid number of arguments"}if(g!==0){e=Math.sin(g*a.DEG_TO_RAD);i=Math.cos(g*a.DEG_TO_RAD);h=a.Matrix._tmpMat1;h.set(1,0,0,0,i,e,0,-e,i,0,0,0).toGlobal(this);this.set(h)}if(f!==0){e=Math.sin(f*a.DEG_TO_RAD);i=Math.cos(f*a.DEG_TO_RAD);h=a.Matrix._tmpMat1;h.set(i,0,-e,0,1,0,e,0,i,0,0,0).toGlobal(this);this.set(h)}if(d!==0){e=Math.sin(d*a.DEG_TO_RAD);i=Math.cos(d*a.DEG_TO_RAD);h=a.Matrix._tmpMat1;h.set(i,e,0,-e,i,0,0,0,1,0,0,0).toGlobal(this);this.set(h)}return this};c.prototype.scale=function(f,e,d){if(arguments.length!==3){throw"DivSugar: invalid number of arguments"}this.xAxis.mul(f);this.yAxis.mul(e);this.zAxis.mul(d);return this};c.prototype.slerp=function(h,f){var d,g,e;if(f>1-a.EPSILON){this.set(h)}else{if(f>=a.EPSILON){e=a.Matrix._tmpVec1;d=a.Matrix._tmpQuat1;g=a.Matrix._tmpQuat2;d.fromMatrix(this);g.fromMatrix(h);e.set(this.trans).lerp(h.trans,f);this.fromQuaternion(d.slerp(g,f));this.trans.set(e)}}return this};c.prototype.slerp_noTrans=function(g,e){var d,f;if(e>1-a.EPSILON){this.set(g);this.trans.set(a.Vector.ZERO)}else{if(e>=a.EPSILON){d=a.Matrix._tmpQuat1;f=a.Matrix._tmpQuat2;d.fromMatrix(this);f.fromMatrix(g);this.fromQuaternion(d.slerp(f,e))}else{this.trans.set(a.Vector.ZERO)}}return this};c.prototype.toLocal=function(f){var g,h,d,e;e=a.Matrix._tmpVec1;g=1/f.xAxis.sqNorm();h=1/f.yAxis.sqNorm();d=1/f.zAxis.sqNorm();e.set(this.trans).sub(f.trans);this.set(this.xAxis.dot(f.xAxis)*g,this.xAxis.dot(f.yAxis)*h,this.xAxis.dot(f.zAxis)*d,this.yAxis.dot(f.xAxis)*g,this.yAxis.dot(f.yAxis)*h,this.yAxis.dot(f.zAxis)*d,this.zAxis.dot(f.xAxis)*g,this.zAxis.dot(f.yAxis)*h,this.zAxis.dot(f.zAxis)*d,e.dot(f.xAxis)*g,e.dot(f.yAxis)*h,e.dot(f.zAxis)*d);return this};c.prototype.toGlobal=function(d){this.xAxis.toGlobal_noTrans(d);this.yAxis.toGlobal_noTrans(d);this.zAxis.toGlobal_noTrans(d);this.trans.toGlobal(d);return this};c.prototype.toLocal_noTrans=function(e){var f,g,d;f=1/e.xAxis.sqNorm();g=1/e.yAxis.sqNorm();d=1/e.zAxis.sqNorm();this.set(this.xAxis.dot(e.xAxis)*f,this.xAxis.dot(e.yAxis)*g,this.xAxis.dot(e.zAxis)*d,this.yAxis.dot(e.xAxis)*f,this.yAxis.dot(e.yAxis)*g,this.yAxis.dot(e.zAxis)*d,this.zAxis.dot(e.xAxis)*f,this.zAxis.dot(e.yAxis)*g,this.zAxis.dot(e.zAxis)*d,0,0,0);return this};c.prototype.toGlobal_noTrans=function(d){this.xAxis.toGlobal_noTrans(d);this.yAxis.toGlobal_noTrans(d);this.zAxis.toGlobal_noTrans(d);this.trans.set(a.Vector.ZERO);return this};c.prototype.lookAt=function(f,e,d){this.zAxis.set(f).sub(e).normalize();this.xAxis.set(d).cross(this.zAxis).normalize();this.yAxis.set(this.zAxis).cross(this.xAxis);this.trans.set(f);return this};c.prototype.equal=function(d){return this.xAxis.equal(d.xAxis)&&this.yAxis.equal(d.yAxis)&&this.zAxis.equal(d.zAxis)&&this.trans.equal(d.trans)};c.prototype.toString=function(){return"("+(this.xAxis.toString())+", "+(this.yAxis.toString())+", "+(this.zAxis.toString())+", "+(this.trans.toString())+")"};c.prototype.toCSSTransform=function(){var d;d=a.NUM_OF_DIGITS;return"matrix3d("+(""+(this.xAxis.x.toFixed(d))+", "+(this.xAxis.y.toFixed(d))+", "+(this.xAxis.z.toFixed(d))+", 0, ")+(""+(this.yAxis.x.toFixed(d))+", "+(this.yAxis.y.toFixed(d))+", "+(this.yAxis.z.toFixed(d))+", 0, ")+(""+(this.zAxis.x.toFixed(d))+", "+(this.zAxis.y.toFixed(d))+", "+(this.zAxis.z.toFixed(d))+", 0, ")+(""+(this.trans.x.toFixed(d))+", "+(this.trans.y.toFixed(d))+", "+(this.trans.z.toFixed(d))+", 1)")};return c})();a.Matrix.UNIT=new a.Matrix(1,0,0,0,1,0,0,0,1,0,0,0);a.Matrix._tmpVec1=new a.Vector();a.Matrix._tmpVec2=new a.Vector();a.Matrix._tmpVec3=new a.Vector();a.Matrix._tmpMat1=new a.Matrix();a.Quaternion=(function(){function c(d,h,g,e){var f;switch(arguments.length){case 0:this.x=this.y=this.z=this.w=0;break;case 1:f=d;this.x=f.x;this.y=f.y;this.z=f.z;this.w=f.w;break;case 4:this.x=d;this.y=h;this.z=g;this.w=e;break;default:throw"DivSugar: invalid number of arguments"}}c.prototype.set=function(d,h,g,e){var f;switch(arguments.length){case 1:f=d;this.x=f.x;this.y=f.y;this.z=f.z;this.w=f.w;break;case 4:this.x=d;this.y=h;this.z=g;this.w=e;break;default:throw"DivSugar: invalid number of arguments"}return this};c.prototype.fromMatrix=function(h){var g,e,j,f,d,l,i;e=h.xAxis;j=h.yAxis;f=h.zAxis;i=e.x+j.y+f.z;if(i>0){d=Math.sqrt(i+1);l=0.5/d;this.set((j.z-f.y)*l,(f.x-e.z)*l,(e.y-j.x)*l,d*0.5)}else{g=j.y>e.x?(f.z>j.y?2:1):(f.z>e.x?2:0);switch(g){case 0:d=Math.sqrt(e.x-(j.y+f.z)+1);l=d!==0?0.5/d:d;this.set(d*0.5,(e.y+j.x)*l,(f.x+e.z)*l,(j.z-f.y)*l);break;case 1:d=Math.sqrt(j.y-(f.z+e.x)+1);l=d!==0?0.5/d:d;this.set((e.y+j.x)*l,d*0.5,(j.z+f.y)*l,(f.x-e.z)*l);break;case 2:d=Math.sqrt(f.z-(e.x+j.y)+1);l=d!==0?0.5/d:d;this.set((f.x+e.z)*l,(j.z+f.y)*l,d*0.5,(e.y-j.x)*l)}}return this};c.prototype.slerp=function(k,e){var d,j,f,i,h,g;if(e>1-a.EPSILON){this.set(k)}else{if(e>=a.EPSILON){f=a.Quaternion._tmpQuat1;d=this.x*k.x+this.y*k.y+this.z*k.z+this.w*k.w;if(d<0){d=-d;f.set(-k.x,-k.y,-k.z,-k.w)}else{f.set(k)}if(d>=1){this.set(k)}else{j=Math.acos(d>1?1:d);g=Math.sin(j);i=Math.sin(j*(1-e))/g;h=Math.sin(j*e)/g;this.set(this.x*i+f.x*h,this.y*i+f.y*h,this.z*i+f.z*h,this.w*i+f.w*h)}}}return this};c.prototype.equal=function(d){return this.x===d.x&&this.y===d.y&&this.z===d.z&&this.w===d.w};c.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};return c})();a.Quaternion._tmpQuat1=new a.Quaternion();a.Matrix._tmpQuat1=new a.Quaternion();a.Matrix._tmpQuat2=new a.Quaternion();a.Scene=(function(){function c(d){this.isScene=true;this.div=document.createElement("div");if(d!=null){this.div.id=d}this.div.style.margin="0px";this.div.style.padding="0px";this.div.style.position="relative";this.div.style.overflow="hidden";this.div.style[a.cssTransformStyle]="preserve-3d";this.div.style[a.cssTransformOrigin]="0% 0%";this.div.style[a.cssPerspectiveOrigin]="50% 50%";this.div.sugar=this;this._rootNode=new a.Node();this._rootNode.div.sugar=this;this.div.appendChild(this._rootNode.div);this.setViewAngle(45);this.setSize(400,300);this.setPosition(0,0);this.setVisible(true);this.setClip(true);this.setOpacity(1);this.setImage("#0000ff");this.setImageClip(0,0,1,1)}c.prototype.getParent=function(){return this.div.parentNode};c.prototype.append=function(d){this._rootNode.div.appendChild(d.div);return this};c.prototype.appendTo=function(d){d.appendChild(this.div);return this};c.prototype.remove=function(e){var d;if(d=e.div,b.call(this._rootNode.div.childNodes,d)>=0){this._rootNode.div.removeChild(e.div)}return this};c.prototype.getViewAngle=function(){return this._viewAngle};c.prototype.getPerspective=function(){return this._perspective};c.prototype.setViewAngle=function(d){this._viewAngle=d;this._perspective=Math.tan((90-d/2)*a.DEG_TO_RAD)*this._viewWidth/2;this.div.style[a.cssPerspective]=""+(this._perspective.toFixed(a.NUM_OF_DIGITS))+"px";return this};c.prototype.getWidth=function(){return this._width};c.prototype.getHeight=function(){return this._height};c.prototype.getViewWidth=function(){return this._viewWidth};c.prototype.getViewHeight=function(){return this._viewHeight};c.prototype.setSize=function(g,d,f,e){if(f==null){f=g}if(e==null){e=d}this._width=g;this._height=d;this._viewWidth=f;this._viewHeight=e;this.div.style.width=""+(g.toFixed(a.NUM_OF_DIGITS))+"px";this.div.style.height=""+(d.toFixed(a.NUM_OF_DIGITS))+"px";this._rootNode.setTransform(a.Matrix.UNIT).scale(g/f,d/e,1);this.setViewAngle(this._viewAngle);return this};c.prototype.getPositionX=function(){return this._positionX};c.prototype.getPositionY=function(){return this._positionY};c.prototype.setPosition=function(d,e){if(arguments.length!==2){throw"DivSugar: invalid number of arguments"}this._positionX=d;this._positionY=e;this.div.style.left=""+(d.toFixed(a.NUM_OF_DIGITS))+"px";this.div.style.top=""+(e.toFixed(a.NUM_OF_DIGITS))+"px";return this};c.prototype.getVisible=function(){return this._visible};c.prototype.setVisible=function(d){this._visible=d;this.div.style.visibility=d?"visible":"hidden";return this};c.prototype.getClip=function(){return this._clip};c.prototype.setClip=function(d){this._clip=d;this.div.style.overflow=d?"hidden":"visible";return this};c.prototype.getOpacity=function(){return this._opacity};c.prototype.setOpacity=function(d){this._opacity=d;this.div.style.opacity=d.toFixed(a.NUM_OF_DIGITS);return this};c.prototype.getImage=function(){return this._image};c.prototype.setImage=function(d,e){this._image=d;if(d==null){this.div.style.backgroundColor="transparent";this.div.style.backgroundImage="none"}else{if(d.charAt(0)==="#"){this.div.style.backgroundColor=d;this.div.style.backgroundImage="none"}else{this.div.style.backgroundColor="transparent";this.div.style.backgroundImage="url("+d+")";if(e!=null){a.getImageSize(d,e)}}}return this};c.prototype.getImageClipU1=function(){return this._imageClipU1};c.prototype.getImageClipV1=function(){return this._imageClipV1};c.prototype.getImageClipU2=function(){return this._imageClipU2};c.prototype.getImageClipV2=function(){return this._imageClipV2};c.prototype.setImageClip=function(e,k,d,i){var f,m,l,j,g;e=e<0?0:e>1?1:e;k=k<0?0:k>1?1:k;d=d<0?0:d>1?1:d;i=i<0?0:i>1?1:i;this._imageClipU1=e;this._imageClipV1=k;this._imageClipU2=d;this._imageClipV2=i;l=1/(d-e)*100;f=1/(i-k)*100;j=l>100?e*l/(l-100)*100:0;g=f>100?k*f/(f-100)*100:0;m=a.NUM_OF_DIGITS;this.div.style.backgroundPosition=""+(j.toFixed(m))+"% "+(g.toFixed(m))+"%";this.div.style.backgroundSize=""+(l.toFixed(m))+"% "+(f.toFixed(m))+"%";return this};c.prototype.adjustLayout=function(f,d,e){switch(e){case"center":break;case"contain":if(f<d*this._viewWidth/this._viewHeight){this.setSize(f,f*this._viewHeight/this._viewWidth,this._viewWidth,this._viewHeight)}else{this.setSize(d*this._viewWidth/this._viewHeight,d,this._viewWidth,this._viewHeight)}break;case"cover":if(f>d*this._viewWidth/this._viewHeight){this.setSize(f,f*this._viewHeight/this._viewWidth,this._viewWidth,this._viewHeight)}else{this.setSize(d*this._viewWidth/this._viewHeight,d,this._viewWidth,this._viewHeight)}}this.setPosition((f-this._width)/2,(d-this._height)/2);return this};c.prototype.getLocalPosition=function(h,f,e){var g,d,i;g=this.div.getBoundingClientRect();d=(h-g.left)*this._viewWidth/this._width;i=(f-g.top)*this._viewHeight/this._height;e.set(d,i,0);return this};return c})();a.Node=(function(){function c(d){this.div=document.createElement("div");if(d!=null){this.div.id=d}this.div.style.margin="0px";this.div.style.padding="0px";this.div.style.position="absolute";this.div.style[a.cssTransformStyle]="preserve-3d";this.div.style[a.cssTransformOrigin]="0% 0%";this.div.sugar=this;this._transform=new a.Matrix();this._animTasks=[];this.setSize(0,0);this.setPosition(0,0,0);this.setVisible(true);this.setBackface(true);this.setClip(false);this.setOpacity(1);this.setImage(null);this.setImageClip(0,0,1,1)}c.prototype.getParent=function(){var d;d=this.div.parentNode;if(d!=null){return d.sugar}else{return null}};c.prototype.append=function(d){this.div.appendChild(d.div);return this};c.prototype.appendTo=function(d){if(d._rootNode!=null){d._rootNode.div.appendChild(this.div)}else{d.div.appendChild(this.div)}return this};c.prototype.remove=function(e){var d;if(d=e.div,b.call(this.div.childNodes,d)>=0){this.div.removeChild(e.div)}return this};c.prototype.getWidth=function(){return this._width};c.prototype.getHeight=function(){return this._height};c.prototype.setSize=function(e,d){this._width=e;this._height=d;this.div.style.width=""+(e.toFixed(a.NUM_OF_DIGITS))+"px";this.div.style.height=""+(d.toFixed(a.NUM_OF_DIGITS))+"px";return this};c.prototype.getPositionX=function(){return this._transform.trans.x};c.prototype.getPositionY=function(){return this._transform.trans.y};c.prototype.getPositionZ=function(){return this._transform.trans.z};c.prototype.getPosition=function(d){d.x=this._transform.trans.x;d.y=this._transform.trans.y;d.z=this._transform.trans.z;return this};c.prototype.setPosition=function(d,g,f){var e;switch(arguments.length){case 1:e=d;this._transform.trans.set(e);break;case 3:this._transform.trans.x=d;this._transform.trans.y=g;this._transform.trans.z=f;break;default:throw"DivSugar: invalid number of arguments"}this.div.style[a.cssTransform]=this._transform.toCSSTransform();return this};c.prototype.getTransform=function(d){d.set(this._transform);return this};c.prototype.setTransform=function(d){this._transform.set(d);this.div.style[a.cssTransform]=this._transform.toCSSTransform();return this};c.prototype.getVisible=a.Scene.prototype.getVisible;c.prototype.setVisible=a.Scene.prototype.setVisible;c.prototype.getBackface=function(){return this._backface};c.prototype.setBackface=function(d){this._backface=d;this.div.style[a.cssBackfaceVisibility]=d?"visible":"hidden";return this};c.prototype.getClip=a.Scene.prototype.getClip;c.prototype.setClip=a.Scene.prototype.setClip;c.prototype.getOpacity=a.Scene.prototype.getOpacity;c.prototype.setOpacity=a.Scene.prototype.setOpacity;c.prototype.getImage=a.Scene.prototype.getImage;c.prototype.setImage=a.Scene.prototype.setImage;c.prototype.getImageClipU1=a.Scene.prototype.getImageClipU1;c.prototype.getImageClipV1=a.Scene.prototype.getImageClipV1;c.prototype.getImageClipU2=a.Scene.prototype.getImageClipU2;c.prototype.getImageClipV2=a.Scene.prototype.getImageClipV2;c.prototype.setImageClip=a.Scene.prototype.setImageClip;c.prototype.translate=function(d,f,e){if(arguments.length!==3){throw"DivSugar: invalid number of arguments"}this._transform.translate(d,f,e);this.div.style[a.cssTransform]=this._transform.toCSSTransform();return this};c.prototype.rotate=function(f,e,d){if(arguments.length!==3){throw"DivSugar: invalid number of arguments"}this._transform.rotate(f,e,d);this.div.style[a.cssTransform]=this._transform.toCSSTransform();return this};c.prototype.scale=function(f,e,d){if(arguments.length!==3){throw"DivSugar: invalid number of arguments"}this._transform.scale(f,e,d);this.div.style[a.cssTransform]=this._transform.toCSSTransform();return this};c.prototype.playAnimation=function(d){var f,e=this;f=new a.Task();f.animation=d;f._cmdIndex=0;f._firstFrame=true;f.onUpdate=function(){return e._updateAnimation(f)};f.onDestroy=function(){return e._destroyAnimation(f)};f.appendTo(a.rootTask);this._animTasks.push(f);return f};c.prototype._updateAnimation=function(w){var x,u,r,t,l,s,n,m,p,q,o,k,j,h,g,f,e,d,v;while(w.deltaTime>0){if(w._cmdIndex>=w.animation.length){w.destroy();return}l=w.animation[w._cmdIndex];switch(l[0]){case"to":if(w._firstFrame){w._firstFrame=false;w._currentTime=0;w._totalTime=(o=l[2])!=null?o:0;w._easeFunc=(k=l[3])!=null?k:a.Ease.linear;w._fromTransform=null;j=l[1];for(n in j){q=j[n];switch(n){case"size":w._fromSize=[this._width,this._height];break;case"position":w._fromPosition=[this._transform.trans.x,this._transform.trans.y,this._transform.trans.z];break;case"transform":if((h=w._fromTransform)==null){w._fromTransform=new a.Matrix(this._transform)}break;case"visible":this.setVisible(q);break;case"backface":this.setBackface(q);break;case"clip":this.setClip(q);break;case"opacity":w._fromOpacity=this._opacity;break;case"image":this.setImage(q);break;case"imageClip":w._fromImageClip=[this._imageClipU1,this._imageClipV1,this._imageClipU2,this._imageClipV2];break;case"translate":if((g=w._fromTransform)==null){w._fromTransform=new a.Matrix(this._transform)}break;case"rotate":if((f=w._fromTransform)==null){w._fromTransform=new a.Matrix(this._transform)}break;case"scale":if((e=w._fromTransform)==null){w._fromTransform=new a.Matrix(this._transform)}break;default:throw"DivSugar: unknown animation parameter '"+n+"'"}}}if(w._fromTransform!=null){this._transform.set(w._fromTransform)}if(w._totalTime>w._currentTime+w.deltaTime){w._currentTime+=w.deltaTime;w.deltaTime=0}else{w.deltaTime-=w._totalTime;w._currentTime=w._totalTime;w._cmdIndex++;w._firstFrame=true}if(w._totalTime>0){u=w._easeFunc(w._currentTime/w._totalTime);x=1-u}else{u=1;x=0}d=l[1];for(n in d){q=d[n];switch(n){case"size":p=w._fromSize;this.setSize(p[0]*x+q[0]*u,p[1]*x+q[1]*u);break;case"position":m=w._fromPosition;this.setPosition(m[0]*x+q[0]*u,m[1]*x+q[1]*u,m[2]*x+q[2]*u);break;case"transform":this.setTransform(a.Node._tmpMat1.set(this._transform).slerp(q,u));break;case"opacity":this.setOpacity(w._fromOpacity*x+q*u);break;case"imageClip":t=w._fromImageClip;this.setImageClip(t[0]*x+q[0]*u,t[1]*x+q[1]*u,t[2]*x+q[2]*u,t[3]*x+q[3]*u);break;case"translate":this.translate(q[0]*u,q[1]*u,q[2]*u);break;case"rotate":this.rotate(q[0]*u,q[1]*u,q[2]*u);break;case"scale":this.scale(x+q[0]*u,x+q[1]*u,x+q[2]*u)}}break;case"wait":if(w._firstFrame){w._firstFrame=false;w._waitTime=l[1]}if(w._waitTime>w.deltaTime){w._waitTime-=w.deltaTime;w.deltaTime=0}else{w.deltaTime-=w._waitTime;w._waitTime=0;w._cmdIndex++;w._firstFrame=true}break;case"play":for(s in l){r=l[s];if(s>0){this.playAnimation(l[s])}}w._cmdIndex++;w._firstFrame=true;break;case"call":for(s in l){r=l[s];if(s>0){l[s]()}}w._cmdIndex++;w._firstFrame=true;break;case"repeat":if(w._repeatCount==null){w._repeatCount=(v=l[1])!=null?v:-1}if(w._repeatCount===0){w._cmdIndex++;w._firstFrame=true}else{if(w._repeatCount>0){w._repeatCount--}w._cmdIndex=0;w._firstFrame=true}break;default:throw"DivSugar: unknown animation command '"+l[0]+"'"}}};c.prototype._destroyAnimation=function(e){var d;d=this._animTasks.indexOf(e);if(d>-1){return this._animTasks.splice(d,1)}};c.prototype.clearAnimation=function(){while(this._animTasks.length>0){this._animTasks.shift().destroy()}return this};c.prototype.getWorldPosition=function(d){var e;d.set(this._transform.trans);e=this.div.parentNode;while((e!=null)&&(e.sugar!=null)&&!(e.sugar.isScene!=null)){d.toGlobal(e.sugar._transform);e=e.parentNode}return this};c.prototype.getWorldTransform=function(d){var e;d.set(this._transform);e=this.div.parentNode;while((e!=null)&&(e.sugar!=null)&&!(e.sugar.isScene!=null)){d.toGlobal(e.sugar._transform);e=e.parentNode}return this};return c})();a.Node._tmpMat1=new a.Matrix();a.Task=(function(){function c(d){this.id=d!=null?d:null;this.active=true;this.deltaTime=0;this.onUpdate=null;this.onDestroy=null;this._parent=null;this._children=[]}c.prototype.getParent=function(){return this._parent};c.prototype.update=function(e){var g,f,d;if(this.active){this.deltaTime+=e;if(typeof this.onUpdate==="function"){this.onUpdate()}this.deltaTime=0;f=0;d=this._children.length;while(f<d){g=this._children[f];if(g!=null){g.update(e);f++}else{this._children.splice(f,1);d--}}}return this};c.prototype.destroy=function(){var h,g,e,f,d;if(typeof this.onDestroy==="function"){this.onDestroy()}if((f=this._parent)!=null){f.remove(this)}d=this._children;for(g=0,e=d.length;g<e;g++){h=d[g];if(h!=null){h.destroy()}}return this};c.prototype.append=function(d){this.remove(d);this._children.push(d);d._parent=this;return this};c.prototype.appendTo=function(d){d.append(this);return this};c.prototype.remove=function(e){var d;d=this._children.indexOf(e);if(d>-1){this._children[d]=null;e._parent=null}return this};c.prototype.getTaskById=function(i){var h,e,g,d,f;if(this.id===i){return this}else{f=this._children;for(g=0,d=f.length;g<d;g++){h=f[g];if(h!=null){e=h.getTaskById(i);if(e!=null){return e}}}return null}};return c})();a.rootTask=new a.Task();a.Ease={linear:function(c){return c},quadIn:function(c){return Math.pow(c,2)},cubicIn:function(c){return Math.pow(c,3)},quartIn:function(c){return Math.pow(c,4)},quintIn:function(c){return Math.pow(c,5)},quadOut:function(c){return 1-Math.pow(1-c,2)},cubicOut:function(c){return 1-Math.pow(1-c,3)},quartOut:function(c){return 1-Math.pow(1-c,4)},quintOut:function(c){return 1-Math.pow(1-c,5)},quadInOut:function(c){if(c<0.5){return Math.pow(c*2,2)*0.5}else{return 1-Math.abs(Math.pow(2-c*2,2))*0.5}},cubicInOut:function(c){if(c<0.5){return Math.pow(c*2,3)*0.5}else{return 1-Math.abs(Math.pow(2-c*2,3))*0.5}},quartInOut:function(c){if(c<0.5){return Math.pow(c*2,4)*0.5}else{return 1-Math.abs(Math.pow(2-c*2,4))*0.5}},quintInOut:function(c){if(c<0.5){return Math.pow(c*2,5)*0.5}else{return 1-Math.abs(Math.pow(2-c*2,5))*0.5}}}}).call(this);